# 目录可调整大小功能

## 功能说明

目录区域现在支持通过鼠标拖动来调整高度，让用户可以根据需要自由调整目录显示区域的大小。

## 使用方法

1. **打开目录**
   - 点击工具栏中的列表图标按钮
   - 目录会显示在预览区域上方

2. **调整目录高度**
   - 将鼠标移动到目录区域的底部边缘
   - 光标会变成上下调整大小的样式（↕️）
   - 看到一条横线手柄出现
   - 按住鼠标左键并上下拖动
   - 释放鼠标完成调整

3. **视觉反馈**
   - **悬停状态**：横线手柄会变长，颜色变深
   - **拖动时**：手柄变得更长，背景高亮，光标变为调整大小样式
   - **最小高度**：100px（确保至少可以看到几个标题）
   - **最大高度**：500px（防止占用太多空间）

## 技术实现

### 拖动手柄元素
```html
<div class="mp-toc-container">
  <!-- 目录内容 -->
  <div class="mp-toc-resize-handle">
    <div class="mp-toc-resize-line"></div>
  </div>
</div>
```

### 拖动算法
```typescript
1. mousedown: 记录起始位置和当前高度
2. mousemove: 计算新高度 = 起始高度 + 鼠标移动距离
3. 限制高度在 100px - 500px 之间
4. 动态设置 tocContainer 的 max-height
5. mouseup: 完成拖动，保存新高度
```

### CSS 样式
- **拖动手柄**：
  - 位置：`position: absolute; bottom: 0`
  - 高度：12px（点击区域）
  - 光标：`cursor: ns-resize`（上下箭头）
  
- **横线指示器**：
  - 默认：40px 宽，半透明
  - 悬停：60px 宽，不透明
  - 拖动：80px 宽，高亮色

- **拖动时全局样式**：
  - 整个页面光标变为 `ns-resize`
  - 禁用文本选择（`user-select: none`）

## 功能特性

### ✅ 平滑交互
- 鼠标悬停时有视觉反馈
- 拖动时整个界面响应调整大小操作
- 释放后立即恢复正常状态

### ✅ 高度限制
- **最小高度**：100px
  - 确保至少显示标题和几个目录项
  - 防止目录完全消失
  
- **最大高度**：500px
  - 防止目录占用过多屏幕空间
  - 保证预览区域有足够显示空间

### ✅ 状态保持
- 调整后的高度会保持
- 重新打开目录时恢复到上次的高度
- 更新目录内容时保持高度设置

### ✅ 兼容性
- 不影响目录的其他功能
- 仍然可以点击目录项跳转
- 仍然可以隐藏/显示目录
- 目录内容仍然可以滚动

## 视觉效果

### 默认状态
```
┌─────────────────────────┐
│      目录标题           │
│  • 标题 1               │
│  • 标题 2               │
│  • 标题 3               │
└─────────────────────────┘  ← 不可见的拖动区域
```

### 鼠标悬停
```
┌─────────────────────────┐
│      目录标题           │
│  • 标题 1               │
│  • 标题 2               │
│  • 标题 3               │
└─────────────────────────┘
       ═════                ← 横线变长变亮
```

### 拖动时
```
┌─────────────────────────┐
│      目录标题           │
│  • 标题 1               │
│  • 标题 2               │
│  • 标题 3               │
└─────────────────────────┘
     ═══════════            ← 横线更长，背景高亮
          ↕                ← 光标变化
```

## 修改的文件

1. **src/view.ts**
   - 添加 `setupTocResize()` 方法：处理拖动逻辑
   - 在创建目录时添加拖动手柄
   - 在更新目录时重新添加拖动手柄
   - 使用 `this.register()` 确保事件监听器正确清理

2. **src/styles/view/toc.css**
   - 添加 `.mp-toc-resize-handle` 样式（拖动手柄容器）
   - 添加 `.mp-toc-resize-line` 样式（横线指示器）
   - 添加悬停和拖动状态样式
   - 添加全局拖动时的光标样式
   - 更新 `.mp-toc-container` 添加 `position: relative` 和底部内边距

## 注意事项

1. **事件清理**：所有事件监听器都通过 `this.register()` 注册，确保组件销毁时自动清理

2. **性能优化**：拖动时直接修改 CSS，避免重排和重绘

3. **用户体验**：
   - 12px 的点击区域足够大，容易操作
   - 横线指示器清楚地显示可拖动位置
   - 平滑的过渡动画提供良好的视觉反馈

4. **边界情况**：
   - 空目录时也显示拖动手柄
   - 拖动超出范围时自动限制在最小/最大值
   - 快速拖动时不会出现闪烁或跳跃

## 测试清单

- [ ] 打开目录后能看到拖动手柄
- [ ] 鼠标悬停时手柄变化
- [ ] 可以向上拖动减小高度
- [ ] 可以向下拖动增加高度
- [ ] 达到最小高度（100px）时无法继续缩小
- [ ] 达到最大高度（500px）时无法继续放大
- [ ] 拖动时光标变为调整大小样式
- [ ] 释放后高度保持
- [ ] 更新目录后高度保持
- [ ] 隐藏再显示目录后高度保持
- [ ] 不影响目录项的点击跳转功能
